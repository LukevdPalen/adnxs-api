var _get=function e(t,r,E){var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,E)}if("value"in n)return n.value;var o=n.get;return void 0===o?void 0:o.call(E)},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var E=t[r];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(e,E.key,E)}}return function(t,r,E){return r&&e(t.prototype,r),E&&e(t,E),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},_inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("limiter"),require("bluebird"),require("request"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","limiter","bluebird","request","lodash"],t):t(e["null"]={},e._limiter,e.bluebird,e.request,e.lodash)}(this,function(e,t,r,E,n){"use strict";function i(e){return n.isObject(e)&&e.response&&e.response.status&&"OK"!==e.response.status}function o(e){return e.statusCode>=400&&e.statusCode<500}E="default"in E?E["default"]:E;var a={ACCOUNT_RECOVERY_SERVICE:"/account-recovery",AD_PROFILE_SERVICE:"/ad-profile",AD_QUALITY_RULE_SERVICE:"/ad-quality-rule",AD_SERVER_SERVICE:"/ad-server",ADVERTISER_SERVICE:"/advertiser",APP_INSTALLATION_SERVICE:"/app-installation",AUTHENTICATION_SERVICE:"/auth",BATCH_SEGMENT_SERVICE:"/batch-segment",BRAND_COMPANY_SERVICE:"/brand-company",BRAND_SERVICE:"/brand",BROKER_SERVICE:"/broker",BROWSER_SERVICE:"/browser",CAMPAIGN_SERVICE:"/campaign",CARRIER_SERVICE:"/carrier",CATEGORY_SERVICE:"/category",CITY_SERVICE:"/city",CLICK_TRACKER_SERVICE:"/clicktracker",CONTENT_CATEGORY_SERVICE:"/content-category",COUNTRY_SERVICE:"/country",CREATIVE_CUSTOM_REQUEST_TEMPLATE_SERVICE:"/creative-custom-request-template",CREATIVE_CUSTOM_REQUEST_TEMPLATE_TYPE_SERVICE:"/creative-custom-request-template-type",CREATIVE_FOLDER_SERVICE:"/creative-folder",CREATIVE_FORMAT_SERVICE:"/creative-format",CREATIVE_MACRO_CHECK_SERVICE:"/creative-macro-check",CREATIVE_SEARCH_SERVICE:"/creative-search",CREATIVE_SERVICE:"/creative",CREATIVE_TEMPLATE_SERVICE:"/template",CURRENCY_SERVICE:"/currency",DEAL_BUYER_ACCESS_SERVICE:"/package-buyer-access",DEAL_FROM_PACKAGE_SERVICE:"/deal-from-package",DEAL_SERVICE:"/deal",DEMOGRAPHIC_AREA_SERVICE:"/dma",DEVELOPER_SERVICE:"/developer",DEVICE_MAKE_SERVICE:"/device-make",DEVICE_MODEL_SERVICE:"/device-model",DOMAIN_AUDIT_STATUS_SERVICE:"/url-audit-search",DOMAIN_LIST_SERVICE:"/domain-list",EXTERNAL_INVENTORY_CODE_SERVICE:"/external-inv-code",EXTRACT_CLICKTAGS_SERVICE:"/extract-click-tags",FEED_STATUS_SERVICE:"/feed-status",IMPRESSION_TRACKER_SERVICE:"/imptracker",INSERTION_ORDER_SERVICE:"/insertion-order",INVENTORY_ATTRIBUTE_SERVICE:"/inventory-attribute",INVENTORY_GROUP_SERVICE:"/inventory-group",INVENTORY_RESOLD_SERVICE:"/inventory-resold",INVENTORY_SOURCE_SERVICE:"/inventory-source",IP_RANGE_LIST_SERVICE:"/ip-range-list",LABEL_SERVICE:"/label",LANGUAGE_SERVICE:"/language",LINE_ITEM_SERVICE:"/line-item",LOG_LEVEL_DATA_SERVICE:"/siphon",LOOKUP_SERVICE:"/lookup",MANUAL_OFFER_RANKING_SERVICE:"/manual-offer-ranking",MEDIA_SUBTYPE_SERVICE:"/media-subtype",MEDIA_TYPE_SERVICE:"/media-type",MEMBER_PROFILE_SERVICE:"/member-profile",MEMBER_SERVICE:"/member",MOBILE_APP_INSTANCE_LIST_SERVICE:"/mobile-app-instance-list",MOBILE_APP_INSTANCE_SERVICE:"/mobile-app-instance",MOBILE_APP_SERVICE:"/mobile-app",MOBILE_APP_STORE_SERVICE:"/mobile-app-store",OBJECT_LIMIT_SERVICE:"/object-limit",OPERATING_SYSTEM_EXTENDED_SERVICE:"/operating-system-extended",OPERATING_SYSTEM_FAMILY_SERVICE:"/operating-system-family",OPERATING_SYSTEM_SERVICE:"/operating-system",OPTIMIZATION_ZONE_SERVICE:"/optimization-zone",PACKAGE_BUYER_ACCESS_SERVICE:"/package-buyer-access",PACKAGE_SERVICE:"/package",PAYMENT_RULE_SERVICE:"/payment-rule",PIXEL_SERVICE:"/pixel",PIXEL_TEMPLATE_SERVICE:"/pixel-template",PLACEMENT_SERVICE:"/placement",PLATFORM_MEMBER_SERVICE:"/platform-member",PLUGIN_INSTANCE_SERVICE:"/plugin-instance",PLUGIN_SERVICE:"/plugin",PROFILE_SERVICE:"/profile",PROFILE_SUMMARY_SERVICE:"/profile-summary",PUBLISHER_SERVICE:"/publisher",REGION_SERVICE:"/region",REPORT_SERVICE:"/report",REPORT_STATUS_SERVICE:"/report-status",SAVED_REPORT_SERVICE:"/saved-report",SEARCH_SERVICE:"/search",SEGMENT_SERVICE:"/segment",SIPHON_CONFIG_SERVICE:"/siphon-config",SITE_SERVICE:"/site",TAG_PARSER_SERVICE:"/tag-parser-job",TECHNICAL_ATTRIBUTE_SERVICE:"/technical-attribute",THIRD_PARTY_PAGE_ACCESS_SERVICE:"/thirdparty-pageaccess",THIRD_PARTY_PIXEL_SERVICE:"/thirdparty-pixel",TOWN_SERVICE:"/town",USER_GROUP_PATTERN_SERVICE:"/usergroup-pattern",USER_SERVICE:"/user",USER_VERIFICATION_SERVICE:"/user-verification",VISIBILITY_PROFILE_SERVICE:"/visibility-profile"},s=a;e.endpoints=s;var _=function(e){function t(r){_classCallCheck(this,t);var E=new e;return E.__proto__=t.prototype,E.name="RequestError",E.message=String(r),E.cause=r,E}return _inherits(t,e),t}(Error),u=function(e){function t(r,E){_classCallCheck(this,t);var n=new e;return n.__proto__=t.prototype,n.name="StatusCodeError",n.statusCode=r,n.message=r+" - "+E,n}return _inherits(t,e),t}(Error),R=function(){function e(){var t=void 0===arguments[0]?{apiBase:"/"}:arguments[0];_classCallCheck(this,e),this.options=t}return _createClass(e,[{key:"get",value:function(e){var t=void 0===arguments[1]?{}:arguments[1];return this.request("GET",e,t)}},{key:"put",value:function(e){var t=void 0===arguments[1]?{}:arguments[1];return this.request("PUT",e,t)}},{key:"post",value:function(e){var t=void 0===arguments[1]?{}:arguments[1];return this.request("POST",e,t)}},{key:"delete",value:function(e){var t=void 0===arguments[1]?{}:arguments[1];return this.request("DELETE",e,t)}},{key:"requestPromise",value:function(e){return new r.Promise(function(t,r){E(e,function(e,E,n){if(e)r(new _(e));else if(o(E)){var a=n.response&&n.response.error?n.response.error:E.statusMessage;r(new u(E.statusCode,a))}else i(n)?r(new _(Error(n.response.error))):E.statusCode>=500?r(new u(E.statusCode,E.statusMessage)):t([n,E])})})}},{key:"request",value:function(e,t,r){var E={method:e,uri:this.options.apiBase+t};return"GET"===e?(E.json=!0,E.qs=r):E.json=r,this.options.token&&this.options.token.value&&(E.headers={Authorization:this.options.token.value}),this.requestPromise(E).then(function(e){return e.response})}}]),e}(),I=R;e.Transport=I;var C=3e5,S=6e4,c=6e4,p=100,l=60,T=10,V=36e5,A={},m=function(e){function E(){var e=void 0===arguments[0]?"http://api.appnexus.com":arguments[0],r=void 0===arguments[1]?{write:l,read:p,auth:T}:arguments[1];_classCallCheck(this,E),_get(Object.getPrototypeOf(E.prototype),"constructor",this).call(this),this.options={apiBase:e,limits:r},this.writeLimiter=new t.RateLimiter(r.write,c),this.readLimiter=new t.RateLimiter(r.read,S),this.authLimiter=new t.RateLimiter(r.auth,C)}return _inherits(E,e),_createClass(E,[{key:"authorize",value:function(e,t){var r=this;if(!e||!t)throw Error("Authorization credentials are missing!");var E={auth:{username:e,password:t}};return this.options.token&&delete this.options.token,this.post(s.AUTHENTICATION_SERVICE,E).then(function(e){return r.options.token={value:e.token,_ts:+new Date},e.token})}},{key:"refreshToken",value:function(){if(!A.username||!A.password)throw Error("Authorization credentials are missing!");return this.authorize(A.username,A.password)}},{key:"isExpired",value:function(){var e=void 0===arguments[0]?0:arguments[0],t=this.options.token&&this.options.token._ts?this.options.token._ts:e;return t+V<=+new Date}},{key:"rateLimiter",value:function(e,t){var E=this;return new r.Promise(function(r,n){var i=null;if(t===s.AUTHENTICATION_SERVICE)i=E.authLimiter;else if("POST"===e||"PUT"===e||"DELETE"===e)i=E.writeLimiter;else{if("GET"!==e)return r();i=E.readLimiter}i.removeTokens(1,function(e,t){return e?n(e):void r(t)})})}},{key:"request",value:function(){for(var e=this,t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];var i=this,o=r[0],a=r[1];return this.rateLimiter(o,a).then(function(){return a!==s.AUTHENTICATION_SERVICE&&e.isExpired()?e.refreshToken().then(_get(Object.getPrototypeOf(E.prototype),"request",i).apply(i,r)):_get(Object.getPrototypeOf(E.prototype),"request",i).apply(i,r)})}}]),E}(I),f=m;e.Client=f});
//# sourceMappingURL=appnxs-lib-dist.min.js.map